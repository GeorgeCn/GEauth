<!DOCTYPE html>
<HTML>
<HEAD>
    <TITLE> ZTREE DEMO - checkbox</TITLE>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="__PUBLIC__/zTree/css/demo.css" type="text/css">
    <link rel="stylesheet" href="__PUBLIC__/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script type="text/javascript" src="__PUBLIC__/zTree/js/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/zTree/js/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="__PUBLIC__/zTree/js/jquery.ztree.excheck.js"></script>

    <link rel="shortcut icon" href="favicon.ico"> <link href="__PUBLIC__/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="__PUBLIC__/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="__PUBLIC__/css/animate.css" rel="stylesheet">
    <link href="__PUBLIC__/css/style.css?v=4.1.0" rel="stylesheet">

    <!-- 全局js -->
    <!--<script src="__PUBLIC__/js/jquery.min.js?v=2.1.4"></script>-->
    <script src="__PUBLIC__/js/bootstrap.min.js?v=3.3.6"></script>
    <!-- 自定义js -->
    <script src="__PUBLIC__/js/content.js?v=1.0.0"></script>
    <script src="__PUBLIC__/js/plugins/layer/layer.js"></script>

    <SCRIPT type="text/javascript">
        var data = <?php echo $data ?>;
        var setting = {
            check: {
                enable: true
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                onCheck: onCheck
            }
        };
        var zNodes = data;
        var code;
        function setCheck() {
            var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
            //默认关联父与子元素
            type = { "Y":'p' + 's', "N":'p' + 's'};
            zTree.setting.check.chkboxType = type;
            showCode('setting.check.chkboxType = { "Y" : "' + type.Y + '", "N" : "' + type.N + '" };');
        }
        function showCode(str) {
            if (!code) code = $("#code");
            code.empty();
            code.append("<li>"+str+"</li>");
        }

        function onCheck(e, treeId, treeNode) {
            //alert(treeNode.id + treeNode.name );
            var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
                    nodes = zTree.getCheckedNodes();
            var v="";
            for(var i=0;i<nodes.length;i++){
                v+=nodes[i]['id'] + ";";
            }
            document.getElementById('authlist').value = v;
        }

        $(document).ready(function(){
            $.fn.zTree.init($("#treeDemo"), setting, zNodes);
            setCheck();
        });


        function authrize(uid){
            var nodeslist = $('#authlist').val();
            $.ajax({
                type:'post',
                url:"__APP__/Auth/index",
                data:{
                    uid:uid,
                    lists:nodeslist
                },
                dateType:'json',
                success:function(msg){
                    if(msg){
                        layer.msg('授权成功');
                        window.location.href="__APP__/Role/index";
                    }
                }
            })
        }

    </SCRIPT>
</HEAD>
<BODY>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-6">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>角色授权</h5>
                </div>
                <div class="ibox-content">
                    <div class="form-horizontal m-t" id="signupForm">
                        <div class="form-group">
                            <ul id="treeDemo" class="ztree"></ul>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-8 " style="margin-left:3%;">
                                <input type="hidden" name="authlist" id="authlist" value=""/>
                                <button class="btn btn-info" type="button" onclick="authrize({$uid});">授权</button>
                                <button class="btn btn-default" type="button">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</BODY>
</HTML>





